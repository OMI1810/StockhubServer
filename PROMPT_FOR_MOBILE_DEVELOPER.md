# –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Java/Android)

## üìã –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

---

# –ó–∞–¥–∞—á–∞: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ (Java)

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

–Ø —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—é backend API –Ω–∞ NestJS, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
- **–î–ª—è –≤–µ–±-—Å–∞–π—Ç–∞**: Cookie-based —Å–µ—Å—Å–∏–∏ (–Ω–µ –∫–∞—Å–∞–µ—Ç—Å—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- **–î–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: JWT —Ç–æ–∫–µ–Ω—ã (Access Token + Refresh Token)

–ú–Ω–µ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —á–∞—Å—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞ Java.

---

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π URL
```
https://api.example.com
```

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
POST /auth/mobile/register
Content-Type: application/json

Body:
{
  "email": "user@example.com",
  "password": "password123",
  "passwordRepeat": "password123",
  "firstName": "–ò–≤–∞–Ω",
  "lastName": "–ò–≤–∞–Ω–æ–≤",
  "middleName": "–ò–≤–∞–Ω–æ–≤–∏—á"  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):
{
  "message": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ. –ù–∞ –≤–∞—à email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∏—Å—å–º–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è."
}

–û—à–∏–±–∫–∏:
- 409: Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- 400: –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

### 2. –õ–æ–≥–∏–Ω
```
POST /auth/mobile/login
Content-Type: application/json

Body:
{
  "email": "user@example.com",
  "password": "password123"
}

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):
{
  "user": {
    "userId": "123e4567-e89b-12d3-a456-426614174000",
    "email": "user@example.com",
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ò–≤–∞–Ω–æ–≤",
    "middleName": "–ò–≤–∞–Ω–æ–≤–∏—á",
    "role": "USER",
    "isVerified": true
  },
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "550e8400-e29b-41d4-a716-446655440000",
  "expiresIn": 900  // –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ Access Token –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (15 –º–∏–Ω—É—Ç)
}

–û—à–∏–±–∫–∏:
- 401: –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–ª–∏ email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
- 404: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Access Token
```
POST /auth/mobile/refresh
Content-Type: application/json

Body:
{
  "refreshToken": "550e8400-e29b-41d4-a716-446655440000"
}

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresIn": 900
}

–û—à–∏–±–∫–∏:
- 401: Refresh Token –Ω–µ–≤–∞–ª–∏–¥–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫
```

### 4. –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
```
POST /auth/mobile/logout
Authorization: Bearer <access_token>
Content-Type: application/json

Body:
{
  "refreshToken": "550e8400-e29b-41d4-a716-446655440000"
}

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):
{}
```

### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
GET /users/profile
Authorization: Bearer <access_token>

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):
{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "email": "user@example.com",
  "firstName": "–ò–≤–∞–Ω",
  "lastName": "–ò–≤–∞–Ω–æ–≤",
  "middleName": "–ò–≤–∞–Ω–æ–≤–∏—á",
  "role": "USER",
  "isVerified": true,
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

### 6. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
```
GET /organizations
Authorization: Bearer <access_token>

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):
[
  {
    "organizationId": "123e4567-e89b-12d3-a456-426614174000",
    "name": "–û–û–û –ö–æ–º–ø–∞–Ω–∏—è",
    "createdBy": "123e4567-e89b-12d3-a456-426614174001",
    "createdAt": "2024-01-01T00:00:00.000Z",
    "role": "ADMIN"
  }
]
```

### 7. –í—ã–±–æ—Ä —Ç–µ–∫—É—â–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
```
POST /organizations/:id/select
Authorization: Bearer <access_token>

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:
- id: ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (UUID)

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200):
{
  "message": "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω–∞.",
  "organization": {
    "organizationId": "123e4567-e89b-12d3-a456-426614174000",
    "name": "–û–û–û –ö–æ–º–ø–∞–Ω–∏—è",
    "role": "ADMIN"
  }
}
```

### 8. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞
```
POST /warehouses
Authorization: Bearer <access_token>
Content-Type: application/json

Body:
{
  "name": "–°–∫–ª–∞–¥ ‚Ññ1",
  "address": "—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1",
  "city": "–ú–æ—Å–∫–≤–∞",
  "state": "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
  "zip": "123456",
  "country": "–†–æ—Å—Å–∏—è"
}

–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (201):
{
  "warehouseId": "123e4567-e89b-12d3-a456-426614174000",
  "organizationId": "223e4567-e89b-12d3-a456-426614174002",
  "name": "–°–∫–ª–∞–¥ ‚Ññ1",
  "address": "—É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1",
  "city": "–ú–æ—Å–∫–≤–∞",
  "state": "–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å",
  "zip": "123456",
  "country": "–†–æ—Å—Å–∏—è",
  "status": "ACTIVE",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

---

## üîë –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–∞–º–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–æ–∫–µ–Ω–æ–≤:

1. **Access Token (JWT)**
   - –§–æ—Ä–º–∞—Ç: JWT —Ç–æ–∫–µ–Ω (—Å—Ç—Ä–æ–∫–∞)
   - –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 15 –º–∏–Ω—É—Ç (900 —Å–µ–∫—É–Ω–¥)
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
   - –•—Ä–∞–Ω–µ–Ω–∏–µ: –í EncryptedSharedPreferences (Android)

2. **Refresh Token**
   - –§–æ—Ä–º–∞—Ç: UUID (—Å—Ç—Ä–æ–∫–∞)
   - –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: 30 –¥–Ω–µ–π
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: –¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ Access Token —á–µ—Ä–µ–∑ `/auth/mobile/refresh`
   - –•—Ä–∞–Ω–µ–Ω–∏–µ: –í EncryptedSharedPreferences (Android)

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:

1. **–ü—Ä–∏ –ª–æ–≥–∏–Ω–µ:**
   - –ü–æ–ª—É—á–∏—Ç—å `accessToken` –∏ `refreshToken` –∏–∑ –æ—Ç–≤–µ—Ç–∞
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–∞ —Ç–æ–∫–µ–Ω–∞ –≤ EncryptedSharedPreferences
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

2. **–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API:**
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å `accessToken` –∏–∑ EncryptedSharedPreferences
   - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer <accessToken>`
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å

3. **–ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ –æ—à–∏–±–∫—É 401 (Unauthorized):**
   - –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Access Token –∏—Å—Ç–µ–∫
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å `refreshToken` –∏–∑ EncryptedSharedPreferences
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ `/auth/mobile/refresh` —Å `refreshToken`
   - –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π `accessToken`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π `accessToken`
   - –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º

4. **–ï—Å–ª–∏ refresh –Ω–µ —É–¥–∞–ª—Å—è (401):**
   - –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Refresh Token –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω
   - –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∏–∑ EncryptedSharedPreferences
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞

5. **–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ:**
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ `/auth/mobile/logout` —Å `refreshToken`
   - –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∏–∑ EncryptedSharedPreferences
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞

---

## üì± –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### 1. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (build.gradle)

```gradle
dependencies {
    // HTTP –∫–ª–∏–µ–Ω—Ç
    implementation 'com.squareup.okhttp3:okhttp:4.12.0'
    implementation 'com.squareup.okhttp3:logging-interceptor:4.12.0'
    
    // JSON –ø–∞—Ä—Å–∏–Ω–≥
    implementation 'com.google.code.gson:gson:2.10.1'
    
    // Encrypted SharedPreferences –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
    implementation 'androidx.security:security-crypto:1.1.0-alpha06'
    
    // Retrofit (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
    implementation 'com.squareup.retrofit2:retrofit:2.9.0'
    implementation 'com.squareup.retrofit2:converter-gson:2.9.0'
}
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–æ–≤

–°–æ–∑–¥–∞–π —Å–ª–µ–¥—É—é—â–∏–µ –∫–ª–∞—Å—Å—ã:

#### TokenManager.java
- –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å EncryptedSharedPreferences
- –ú–µ—Ç–æ–¥—ã: `saveTokens()`, `getAccessToken()`, `getRefreshToken()`, `clearTokens()`, `hasTokens()`

#### ApiClient.java –∏–ª–∏ ApiService.java
- HTTP –∫–ª–∏–µ–Ω—Ç (OkHttp + Retrofit –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ OkHttp)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Access Token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ 401 —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞
- –ú–µ—Ç–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

#### AuthRepository.java
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- –ú–µ—Ç–æ–¥—ã: `login()`, `register()`, `logout()`, `refreshToken()`

#### Models (Data Classes)
- `LoginRequest.java` - –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ª–æ–≥–∏–Ω–∞
- `LoginResponse.java` - –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –ª–æ–≥–∏–Ω–∞
- `RefreshTokenRequest.java` - –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- `RefreshTokenResponse.java` - –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- `User.java` - –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `Organization.java` - –º–æ–¥–µ–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `Warehouse.java` - –º–æ–¥–µ–ª—å —Å–∫–ª–∞–¥–∞

### 3. –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤:**
   - –ò—Å–ø–æ–ª—å–∑—É–π `EncryptedSharedPreferences` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `androidx.security:security-crypto`
   - –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –æ–±—ã—á–Ω—ã–π `SharedPreferences` –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
   - –ö–ª—é—á–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è: `"access_token"` –∏ `"refresh_token"`

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <accessToken>`
   - –ò—Å–ø–æ–ª—å–∑—É–π OkHttp Interceptor –∏–ª–∏ Retrofit Interceptor

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
   - –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏ 401 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–π `/auth/mobile/refresh`
   - –ï—Å–ª–∏ refresh —É—Å–ø–µ—à–µ–Ω - –ø–æ–≤—Ç–æ—Ä—è–π –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
   - –ï—Å–ª–∏ refresh –Ω–µ —É–¥–∞–ª—Å—è - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–π –Ω–∞ —ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - 401 ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ª–æ–≥–∏–Ω
   - 403 ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞"
   - 400 ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   - 500 ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"

5. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:**
   - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–π –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
   - –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã –µ—Å—Ç—å - –∑–∞–≥—Ä—É–∂–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
   - –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–µ—Ç - –ø–æ–∫–∞–∑—ã–≤–∞–π —ç–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Retrofit –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API (—É–¥–æ–±–Ω–µ–µ, —á–µ–º —á–∏—Å—Ç—ã–π OkHttp)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Coroutines –∏–ª–∏ RxJava –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry –ª–æ–≥–∏–∫—É –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏
- –ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞

---

## üîß –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–¥–∞

### TokenManager.java (–ø—Ä–∏–º–µ—Ä)

```java
import android.content.Context;
import androidx.security.crypto.EncryptedSharedPreferences;
import androidx.security.crypto.MasterKey;

public class TokenManager {
    private static final String PREFS_NAME = "secure_prefs";
    private static final String KEY_ACCESS_TOKEN = "access_token";
    private static final String KEY_REFRESH_TOKEN = "refresh_token";
    
    private SharedPreferences sharedPreferences;
    
    public TokenManager(Context context) {
        try {
            MasterKey masterKey = new MasterKey.Builder(context)
                .setKeyScheme(MasterKey.KeyScheme.AES256_GCM)
                .build();
                
            sharedPreferences = EncryptedSharedPreferences.create(
                context,
                PREFS_NAME,
                masterKey,
                EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
                EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
            );
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    public void saveTokens(String accessToken, String refreshToken) {
        sharedPreferences.edit()
            .putString(KEY_ACCESS_TOKEN, accessToken)
            .putString(KEY_REFRESH_TOKEN, refreshToken)
            .apply();
    }
    
    public String getAccessToken() {
        return sharedPreferences.getString(KEY_ACCESS_TOKEN, null);
    }
    
    public String getRefreshToken() {
        return sharedPreferences.getString(KEY_REFRESH_TOKEN, null);
    }
    
    public void clearTokens() {
        sharedPreferences.edit()
            .remove(KEY_ACCESS_TOKEN)
            .remove(KEY_REFRESH_TOKEN)
            .apply();
    }
    
    public boolean hasTokens() {
        return getAccessToken() != null && getRefreshToken() != null;
    }
}
```

### ApiClient —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞ (–ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏)

```java
// –ò—Å–ø–æ–ª—å–∑—É–π OkHttp Interceptor –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
// –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏ 401

public class AuthInterceptor implements Interceptor {
    private TokenManager tokenManager;
    private ApiService apiService;
    
    @Override
    public Response intercept(Chain chain) throws IOException {
        Request originalRequest = chain.request();
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫
        String accessToken = tokenManager.getAccessToken();
        if (accessToken != null) {
            originalRequest = originalRequest.newBuilder()
                .header("Authorization", "Bearer " + accessToken)
                .build();
        }
        
        Response response = chain.proceed(originalRequest);
        
        // –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 401, –ø—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω
        if (response.code() == 401 && accessToken != null) {
            String newToken = refreshToken();
            if (newToken != null) {
                // –ü–æ–≤—Ç–æ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
                Request newRequest = originalRequest.newBuilder()
                    .header("Authorization", "Bearer " + newToken)
                    .build();
                return chain.proceed(newRequest);
            } else {
                // Refresh –Ω–µ —É–¥–∞–ª—Å—è, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ª–æ–≥–∏–Ω
                // (—ç—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ EventBus, LiveData, –∏–ª–∏ callback)
            }
        }
        
        return response;
    }
    
    private String refreshToken() {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
        // ...
    }
}
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

- [ ] **TokenManager** - –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å EncryptedSharedPreferences
- [ ] **ApiClient/ApiService** - HTTP –∫–ª–∏–µ–Ω—Ç —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞
- [ ] **AuthInterceptor** - Interceptor –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ 401 –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- [ ] **AuthRepository** - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] **Models** - –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (User, Organization, Warehouse –∏ —Ç.–¥.)
- [ ] **–≠–∫—Ä–∞–Ω –ª–æ–≥–∏–Ω–∞** - —Å –≤—ã–∑–æ–≤–æ–º `login()` –º–µ—Ç–æ–¥–∞
- [ ] **–≠–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - —Å –≤—ã–∑–æ–≤–æ–º `register()` –º–µ—Ç–æ–¥–∞
- [ ] **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ API
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫:**
   - –ü–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
   - –†–µ–∞–ª–∏–∑—É–π retry –ª–æ–≥–∏–∫—É –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

2. **UX:**
   - –ü–æ–∫–∞–∑—ã–≤–∞–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö
   - –ë–ª–æ–∫–∏—Ä—É–π –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
   - –ü–æ–∫–∞–∑—ã–≤–∞–π –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - –ù–ò–ö–û–ì–î–ê –Ω–µ –ª–æ–≥–∏—Ä—É–π —Ç–æ–∫–µ–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª—å
   - –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ EncryptedSharedPreferences –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
   - –ü—Ä–æ–≤–µ—Ä—è–π –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å

**Q: –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—É—á–∏–ª–∏ 401?**
A: –†–µ–∞–ª–∏–∑—É–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—á–µ—Ä–µ–¥–∏ - –µ—Å–ª–∏ —É–∂–µ –∏–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∂–¥–∞—Ç—å –µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

**Q: –ù—É–∂–Ω–æ –ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ?**
A: –î–∞, —Å–æ—Ö—Ä–∞–Ω—è–π –≤ –æ–±—ã—á–Ω–æ–º SharedPreferences –∏–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (Room) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

**Q: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏?**
A: –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–π `organizationId` –ª–æ–∫–∞–ª—å–Ω–æ (–≤ –æ–±—ã—á–Ω–æ–º SharedPreferences). –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö, —Ç—Ä–µ–±—É—é—â–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, –¥–æ–±–∞–≤–ª—è–π `organizationId` –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ body –∑–∞–ø—Ä–æ—Å–∞ (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç).

**Q: –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞?**
A: –≠—Ç–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–ª—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è:
1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω—ã
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å—ã
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏
4. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –æ—à–∏–±–∫–∏
5. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–π API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å backend

---

**–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ API –∏–ª–∏ –ª–æ–≥–∏–∫–µ —Ä–∞–±–æ—Ç—ã - –æ–±—Ä–∞—â–∞–π—Å—è –∫–æ –º–Ω–µ!**

---

